<?phpinclude("config.php");//include("getUnexistTile.php");//include("getTileToJson.php");include("osm2geo.php");//DBfunction selectDB($ip, $uname, $pswd, $database){	$con = mysql_connect($ip, $uname, $pswd);//连接数据库	if(!$con)		die('Could not connect: ' . mysql_error());			$db = mysql_select_db($database, $con);//选择数据库	if(!$db)		die ("Can't use $database : " . mysql_error());	return $con;}function getUnexistTile($Tile_config){	$id = $_GET['tile'];	$arr = explode("_", $id);	$nx = (int)$arr[0];	$ny = (int)$arr[1];	$bx = $Tile_config['width'];	$by = $Tile_config['height'];	$x1 = $nx * $bx;	$y1 = $ny * $by;	$x2 = ($nx+1) * $bx;	$y2 = ($ny+1) * $by;		return getTileToJson($x1, $y1, $x2, $y2, $Tile_config);}function getTileToJson($x1, $y1, $x2, $y2, $Tile_config){	$baseUrl = "http://www.openstreetmap.org/api/0.6/map?bbox=";	$url = $baseUrl.$x1.','.$y1.','.$x2.','.$y2;	//*****************************cURL 扩展库**********************************	$ch = curl_init();	$timeout = 300;	curl_setopt ($ch, CURLOPT_URL, $url);	curl_setopt ($ch, CURLOPT_RETURNTRANSFER, 1);	curl_setopt ($ch, CURLOPT_CONNECTTIMEOUT, $timeout);	$osm = curl_exec($ch);	curl_close($ch);		//********************** to json file *******************************	if($osm)	{		//file_put_contents("../data/osm_".($x1/$Tile_config['width'])."_".(($y1/$Tile_config['height'])).".osm", $osm);//save file		$xml = simplexml_load_string($osm);		$geojson = osm2geo($xml);		$result = json_encode($geojson);		file_put_contents("../data/tile_".($x1/$Tile_config['width'])."_".(($y1/$Tile_config['height'])).".json", $result);//save file		return $result;	}	else	{		return false;	}}//********************************************* main *****************************************************$id = $_GET['tile'];$file = '../data/tile_'.$id.'.json';if(file_exists($file)){	echo file_get_contents($file);}else{	//根据id算出偏移量，再请求	if($_GET['moredata'])		echo getUnexistTile($Tile_config);	else			echo '{"error": "no_map_data"}';}?>